<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Halo finders &mdash; SWIFTGalaxy 0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Particle masking" href="../masking/index.html" />
    <link rel="prev" title="Additional coordinates" href="../additional_coordinates/index.html" />
 <script type="text/javascript">
    $(document).ready(function() {
        //
        //
        $(".toggle > *").hide();
        $(".toggle .admonition-title").show();
        $(".toggle .admonition-title").click(function() {
            $(this).parent().children().not(".admonition-title").toggle(400);
            $(this).parent().children(".admonition-title").toggleClass("open");
        })
    });
</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> SWIFTGalaxy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coordinate_transformations/index.html">Coordinate transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional_coordinates/index.html">Additional coordinates</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Halo finders</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#velociraptor">Velociraptor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hbt">HBT+</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-halo-finders">Other halo finders</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../masking/index.html">Particle masking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/index.html#indices-and-tables">Indices and tables</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SWIFTGalaxy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Halo finders</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/halo_finders/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="halo-finders">
<h1>Halo finders<a class="headerlink" href="#halo-finders" title="Permalink to this headline"></a></h1>
<p><a class="reference internal" href="../modules/swiftgalaxy.html#module-swiftgalaxy" title="swiftgalaxy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">swiftgalaxy</span></code></a> uses a helper class to create a uniform interface to outputs from different halo finders. Provided a python library to read the halo finder outputs already exists, this helper class is usually lightweight and easy to create. Currently, the Velociraptor halo finder has built-in support, and support for HBT+ is planned. Other halo finders may be supported on request – pull requests to the repository are also welcome.</p>
<p>The second argument to create a <a class="reference internal" href="../modules/swiftgalaxy.reader.html#swiftgalaxy.reader.SWIFTGalaxy" title="swiftgalaxy.reader.SWIFTGalaxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">SWIFTGalaxy</span></code></a> is an instance of a class derived from the base helper class <code class="xref py py-class docutils literal notranslate"><span class="pre">_HaloFinder</span></code>, such as <a class="reference internal" href="../modules/swiftgalaxy.halo_finders.html#swiftgalaxy.halo_finders.Velociraptor" title="swiftgalaxy.halo_finders.Velociraptor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Velociraptor</span></code></a>. This object has multiple roles. It will be aware of:</p>
<blockquote>
<div><ul class="simple">
<li><p>the location of the halo finder output files;</p></li>
<li><p>how to extract the properties of a galaxy of interest from those files;</p></li>
<li><p>how to create a mask specifying the particles belonging to a galaxy of interest.</p></li>
</ul>
</div></blockquote>
<section id="velociraptor">
<h2>Velociraptor<a class="headerlink" href="#velociraptor" title="Permalink to this headline"></a></h2>
<p>The <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2019PASA...36...21E/abstract">Velociraptor</a> halo finder is used in several flagship simulation projects, such as Colibre. The <a class="reference internal" href="../modules/swiftgalaxy.halo_finders.html#swiftgalaxy.halo_finders.Velociraptor" title="swiftgalaxy.halo_finders.Velociraptor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Velociraptor</span></code></a> helper class relies on the <a class="reference external" href="https://velociraptor-python.readthedocs.io/en/latest/modules/velociraptor.html#module-velociraptor" title="(in VELOCIraptor Python Tools)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">velociraptor</span></code></a> interface to the halo finder outputs. Setting up an instance of the helper class is straightforward. If the halo finder outputs are named, for example, <code class="file docutils literal notranslate"><em><span class="pre">halos</span></em><span class="pre">.properties</span></code>, <code class="file docutils literal notranslate"><em><span class="pre">halos</span></em><span class="pre">.catalog_groups</span></code>, etc., and the galaxy of interest occupies the 4th row in the catalogue (<code class="docutils literal notranslate"><span class="pre">halo_index=3</span></code>, since rows are indexed from 0), then:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="n">Velociraptor</span><span class="p">(</span>
    <span class="s1">&#39;halos&#39;</span><span class="p">,</span>
    <span class="n">halo_index</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The first argument could also include a path if needed, e.g. <code class="file docutils literal notranslate"><span class="pre">'/path/to/</span><em><span class="pre">halos</span></em><span class="pre">'</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Currently the <a class="reference external" href="https://velociraptor-python.readthedocs.io/en/latest/modules/velociraptor.html#module-velociraptor" title="(in VELOCIraptor Python Tools)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">velociraptor</span></code></a> module does not support selecting galaxies by a unique identifier, e.g. <code class="docutils literal notranslate"><span class="pre">cat.ids.id</span></code>. Users are advised to check this identifier for their selected galaxy to ensure that they obtain the object that they expected.</p>
</div>
<p>The properties of the galaxy of interest as calculated by Velociraptor are made conveniently available with the <code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattr__()</span></code> (dot) syntax, which exposes the interface provided by the <a class="reference external" href="https://velociraptor-python.readthedocs.io/en/latest/modules/velociraptor.html#module-velociraptor" title="(in VELOCIraptor Python Tools)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">velociraptor</span></code></a> module. For example, the virial mass can be accessed as <code class="docutils literal notranslate"><span class="pre">cat.masses.mvir</span></code>. Lists of available properties can be printed interactively using <code class="docutils literal notranslate"><span class="pre">print(cat)</span></code> (or simply <code class="docutils literal notranslate"><span class="pre">cat</span></code> at the python prompt), or <code class="docutils literal notranslate"><span class="pre">print(cat.masses)</span></code>, etc. When a <a class="reference internal" href="../modules/swiftgalaxy.halo_finders.html#swiftgalaxy.halo_finders.Velociraptor" title="swiftgalaxy.halo_finders.Velociraptor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Velociraptor</span></code></a> instance is used to initialize a <a class="reference internal" href="../modules/swiftgalaxy.reader.html#swiftgalaxy.reader.SWIFTGalaxy" title="swiftgalaxy.reader.SWIFTGalaxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">SWIFTGalaxy</span></code></a>, it is made available through the <code class="docutils literal notranslate"><span class="pre">halo_finder</span></code> attribute. For example, to access the virial mass:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sg</span> <span class="o">=</span> <span class="n">SWIFTGalaxy</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">Velociraptor</span><span class="p">(</span>
        <span class="o">...</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">sg</span><span class="o">.</span><span class="n">halo_finder</span><span class="o">.</span><span class="n">masses</span><span class="o">.</span><span class="n">mvir</span>
</pre></div>
</div>
<p>By default, the <a class="reference internal" href="../modules/swiftgalaxy.halo_finders.html#swiftgalaxy.halo_finders.Velociraptor" title="swiftgalaxy.halo_finders.Velociraptor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Velociraptor</span></code></a> class will identify the particles that the halo finder deems bound to the object as belonging to the galaxy. This is controlled by the argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Velociraptor</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">extra_mask</span><span class="o">=</span><span class="s1">&#39;bound_only&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This behaviour can be adjusted. If <code class="docutils literal notranslate"><span class="pre">None</span></code> is passed instead, then only the spatial masking provided by <code class="xref py py-func docutils literal notranslate"><span class="pre">velociraptor.swift.swift.generate_spatial_mask()</span></code> is used. This means that all particles the set of (probably cubic) subvolumes of the simulation that overlap with the region of interest will be read in. Alternatively, a <a class="reference internal" href="../modules/swiftgalaxy.masks.html#swiftgalaxy.masks.MaskCollection" title="swiftgalaxy.masks.MaskCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaskCollection</span></code></a> can be provided. This will be used to select particles from those already selected using <code class="xref py py-func docutils literal notranslate"><span class="pre">generate_spatial_mask()</span></code>.</p>
<p>If a different subset of particles is desired, often the most practical option is to first set up the <a class="reference internal" href="../modules/swiftgalaxy.reader.html#swiftgalaxy.reader.SWIFTGalaxy" title="swiftgalaxy.reader.SWIFTGalaxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">SWIFTGalaxy</span></code></a> with either <code class="docutils literal notranslate"><span class="pre">extra_mask='bound_only'</span></code> or <code class="docutils literal notranslate"><span class="pre">extra_mask=None</span></code> and then use the loaded particles to <a class="reference internal" href="../masking/index.html"><span class="doc">compute a new mask that can then be applied</span></a>, perhaps permanently. Since all particles in the spatial region defined by <code class="xref py py-func docutils literal notranslate"><span class="pre">generate_spatial_mask()</span></code> will always be read in any case, this does not imply any loss of efficiency.</p>
<p>The Velociraptor halo finder computes several centres for halos. By default, the location of the gravitational potential minimum is assumed as the centre of the galaxy (and will be used to <a class="reference internal" href="../coordinate_transformations/index.html"><span class="doc">set the coordinate system</span></a>, unless the argument <code class="docutils literal notranslate"><span class="pre">auto_recentre=False</span></code> is passed to <a class="reference internal" href="../modules/swiftgalaxy.reader.html#swiftgalaxy.reader.SWIFTGalaxy" title="swiftgalaxy.reader.SWIFTGalaxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">SWIFTGalaxy</span></code></a>). Usually the available centring options are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'minpot'</span></code> – potential minimum</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">''</span></code> – centre of mass (?)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'_gas'</span></code> – gas centre of mass (?)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'_star'</span></code> – stellar centre of mass (?)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'mbp'</span></code> – most bound particle</p></li>
</ul>
</div></blockquote>
<p>These can be used as, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Velociraptor</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">centre_type</span><span class="o">=</span><span class="s1">&#39;mbp&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="hbt">
<h2>HBT+<a class="headerlink" href="#hbt" title="Permalink to this headline"></a></h2>
<p>Future support for <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2018MNRAS.474..604H/abstract">HBT+</a> is planned.</p>
</section>
<section id="other-halo-finders">
<h2>Other halo finders<a class="headerlink" href="#other-halo-finders" title="Permalink to this headline"></a></h2>
<p>Support for other halo finders will be considered on request.</p>
<p>Entrepreneurial users may also create their own helper class inheriting from <code class="xref py py-class docutils literal notranslate"><span class="pre">swiftgalaxy.halo_finders._HaloFinder</span></code>. In this case, the following methods should be implemented:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">_load()</span></code>: called during <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code>, implement any initialisation tasks here.</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">_get_spatial_mask()</span></code>: return a <a class="reference external" href="https://swiftsimio.readthedocs.io/en/latest/modules/swiftsimio.masks.html#swiftsimio.masks.SWIFTMask" title="(in SWIFTsimIO)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SWIFTMask</span></code></a> defining the spatial region to be loaded for the galaxy of interest.</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">_get_extra_mask()</span></code>: return a <a class="reference internal" href="../modules/swiftgalaxy.masks.html#swiftgalaxy.masks.MaskCollection" title="swiftgalaxy.masks.MaskCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaskCollection</span></code></a> defining the subset of particles from the loaded spatial region that belong to the galaxy of interest.</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">_centre()</span></code>: return the coordinates (as a <a class="reference external" href="https://swiftsimio.readthedocs.io/en/latest/modules/swiftsimio.objects.html#swiftsimio.objects.cosmo_array" title="(in SWIFTsimIO)"><code class="xref py py-class docutils literal notranslate"><span class="pre">cosmo_array</span></code></a>) to be used as the centre of the galaxy of interest.</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">_vcentre()</span></code>: return the coordinates (as a <a class="reference external" href="https://swiftsimio.readthedocs.io/en/latest/modules/swiftsimio.objects.html#swiftsimio.objects.cosmo_array" title="(in SWIFTsimIO)"><code class="xref py py-class docutils literal notranslate"><span class="pre">cosmo_array</span></code></a>) to be used as the bulk velocity of the galaxy of interest.</p></li>
</ul>
</div></blockquote>
<p>In addition, it is recommended to expose the properties computed by the halo finder, masked to the values corresponding to the object of interest. To make this intuitive for users, the syntax to access attributes of the galaxy of interest should preferably match the syntax used for the library conventionally used to read outputs of that halo finder, if it exists. For instance, for Velociraptor this is implemented via <code class="docutils literal notranslate"><span class="pre">__getattr__</span></code> (dot syntax), which simply exposes the usual interface (with a mask to pick out the galaxy of interest).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../additional_coordinates/index.html" class="btn btn-neutral float-left" title="Additional coordinates" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../masking/index.html" class="btn btn-neutral float-right" title="Particle masking" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Kyle Oman.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>